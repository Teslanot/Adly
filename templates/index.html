{% extends 'base.html' %}
{% load static %}
{% block csslinks %}
<link rel="stylesheet" href="{% static 'css/carousel.css' %}">
{% endblock %}
{% block title %}
Главная
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 to-white">
  <nav class="sticky top-0 z-50 backdrop-blur-xl bg-white/95 border-b border-white/20 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-center overflow-x-auto">
        <div class="flex space-x-1 p-2 flex-nowrap scrollbar-hide">
          <a href="{% url 'home' %}" class="flex-shrink-0 nav-link active px-6 py-3 text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-blue-500 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300">Главная</a>
          <a href="{% url 'top_sellers' %}" class="flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300 hover:-translate-y-0.5">Топ продавцов</a>

          {% if not user.is_authenticated %}
          <a href="{% url 'sign_in' %}" class="flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300 hover:-translate-y-0.5">Регистрация</a>
          <a href="{% url 'login' %}" class="flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300 hover:-translate-y-0.5">Войти</a>
          {% else %}
          <a href="{% url 'post_adv' %}" class="flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300 hover:-translate-y-0.5">Разместить объявление</a>
          <a href="{% url 'profile' %}" class="flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300 hover:-translate-y-0.5">Профиль</a>
          <a href="{% url 'logout' %}" class="flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300 hover:-translate-y-0.5">Выйти</a>
          {% endif %}
        </div>
      </div>
    </div>
  </nav>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="carousel-container relative">
      <div class="absolute top-0 left-0 right-0 h-1 bg-white/10 rounded-full overflow-hidden z-20">
          <div class="progress-bar absolute top-0 left-0 h-full w-1/3 bg-gradient-to-r from-violet-500 to-fuchsia-500"></div>
      </div>

            <button class="nav-button absolute left-2 sm:l  eft-4 top-1/2 -translate-y-1/2 w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center z-20 text-white touch-manipulation" onclick="prevSlide()" title="Previous slide">
                <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
            
            <button class="nav-button absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center z-20 text-white touch-manipulation" onclick="nextSlide()" title="Next slide">
                <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </button>

            <div class="carousel-track relative h-[400px] sm:h-[500px] md:h-[600px] overflow-hidden">
                <div class="carousel-item active absolute top-0 left-0 w-full h-full">
                    <div class="w-full h-full p-4 sm:p-8">
                        <div class="w-full h-full rounded-xl sm:rounded-2xl overflow-hidden relative group">
                            <img src="https://images.unsplash.com/photo-1515462277126-2dd0c162007a?auto=format&fit=crop&q=80" alt="Geometric art installation" class="absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" />
                            <div class="absolute inset-0 bg-gradient-to-br from-violet-500/40 to-purple-500/40 mix-blend-overlay"></div>
                            <div class="absolute inset-x-0 bottom-0 p-4 sm:p-8 bg-gradient-to-t from-black/80 via-black/40 to-transparent">
                                <h3 class="text-white text-xl sm:text-2xl md:text-3xl font-bold mb-2 sm:mb-3">Digital Prism</h3>
                                <p class="text-gray-200 text-sm sm:text-base md:text-lg max-w-2xl">Where geometry meets art in a stunning display of light and form.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="carousel-item next absolute top-0 left-0 w-full h-full">
                    <div class="w-full h-full p-4 sm:p-8">
                        <div class="w-full h-full rounded-xl sm:rounded-2xl overflow-hidden relative group">
                            <img src="https://images.unsplash.com/photo-1550745165-9bc0b252726f?auto=format&fit=crop&q=80" alt="Futuristic tech setup" class="absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" />
                            <div class="absolute inset-0 bg-gradient-to-br from-fuchsia-500/40 to-pink-500/40 mix-blend-overlay"></div>
                            <div class="absolute inset-x-0 bottom-0 p-4 sm:p-8 bg-gradient-to-t from-black/80 via-black/40 to-transparent">
                                <h3 class="text-white text-xl sm:text-2xl md:text-3xl font-bold mb-2 sm:mb-3">Tech Haven</h3>
                                <p class="text-gray-200 text-sm sm:text-base md:text-lg max-w-2xl">Immerse yourself in the cutting edge of technology and innovation.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="carousel-item hidden absolute top-0 left-0 w-full h-full">
                    <div class="w-full h-full p-4 sm:p-8">
                        <div class="w-full h-full rounded-xl sm:rounded-2xl overflow-hidden relative group">
                            <img src="https://images.unsplash.com/photo-1614850523459-c2f4c699c52e?auto=format&fit=crop&q=80" alt="Abstract digital art" class="absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" />
                            <div class="absolute inset-0 bg-gradient-to-br from-pink-500/40 to-rose-500/40 mix-blend-overlay"></div>
                            <div class="absolute inset-x-0 bottom-0 p-4 sm:p-8 bg-gradient-to-t from-black/80 via-black/40 to-transparent">
                                <h3 class="text-white text-xl sm:text-2xl md:text-3xl font-bold mb-2 sm:mb-3">Neural Dreams</h3>
                                <p class="text-gray-200 text-sm sm:text-base md:text-lg max-w-2xl">AI-generated masterpieces that blur the line between human and machine creativity.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="absolute bottom-2 sm:bottom-4 left-1/2 -translate-x-1/2 flex gap-1 sm:gap-2 z-20">
                <button class="w-8 sm:w-12 h-1 sm:h-1.5 rounded-full bg-white/40 hover:bg-white/60 transition-colors" title="Go to slide 1"></button>
                <button class="w-8 sm:w-12 h-1 sm:h-1.5 rounded-full bg-white/20 hover:bg-white/60 transition-colors" title="Go to slide 2"></button>
                <button class="w-8 sm:w-12 h-1 sm:h-1.5 rounded-full bg-white/20 hover:bg-white/60 transition-colors" title="Go to slide 3"></button>
            </div>
        </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <div class="search-form mb-8">
      <form class="flex gap-4 items-center" method="get">
        <div class="flex-1">
          <input type="text" 
                 class="form-control w-full px-4 py-3 bg-white/80 backdrop-blur-sm border-2 border-blue-100 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-300 placeholder-gray-400" 
                 name="query" 
                 placeholder="Поиск объявлений..."
                 value="{% if title %}{{title}}{% endif %}">
        </div>
        <button type="submit" 
                class="btn-success px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-medium rounded-xl shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300">
          Найти
        </button>
      </form>
    </div>


    {% if daily_ads %}
    <div class="mb-12">
      <h2 class="flex items-center mb-4 text-xl font-semibold">
        <span class="w-1 h-6 bg-gradient-to-b from-blue-500 to-blue-600 rounded-full mr-3"></span>
        Новинки за день
      </h2>
      <div class="flex flex-nowrap md:flex-wrap gap-4 overflow-x-auto md:overflow-x-visible scrollbar-hide pb-2">
        {% for adv in daily_ads %}
        <div class="w-56 md:w-[200px] lg:w-[240px] xl:w-[280px] flex-shrink-0 md:flex-shrink md:flex-grow-0 bg-white rounded-lg shadow hover:shadow-lg transition-all duration-300">
          <a href="{{ adv.get_absolute_url }}" class="block group">
            <div class="aspect-square mb-3 overflow-hidden rounded-lg">
              {% if adv.image %}
              <img src="{{ adv.image.url }}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" alt="{{ adv.title }}">
              {% else %}
              <img src="{% static 'img/adv.png' %}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" alt="{{ adv.title }}">
              {% endif %}
            </div>
            <h3 class="font-semibold text-gray-900 group-hover:text-blue-600 transition-colors duration-300 mb-2">{{ adv.title }}</h3>
            <p class="text-sm text-gray-600 mb-2">{{ adv.descriptions|truncatewords:10 }}</p>
            <div class="flex justify-between items-center">
              <span class="text-lg font-bold text-blue-600">{{ adv.prices }}</span>
              <span class="text-xs text-gray-500">{{ adv.created|date:"d.m" }}</span>
            </div>
          </a>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    {% if weekly_ads %}
    <div class="mb-12">
      <h2 class="flex items-center mb-4 text-xl font-semibold">
        <span class="w-1 h-6 bg-gradient-to-b from-purple-500 to-purple-600 rounded-full mr-3"></span>
        Новинки за неделю
      </h2>
      <div class="flex flex-nowrap md:flex-wrap gap-4 overflow-x-auto md:overflow-x-visible scrollbar-hide pb-2">
        {% for adv in weekly_ads %}
        <div class="w-56 md:w-[200px] lg:w-[240px] xl:w-[280px] flex-shrink-0 md:flex-shrink md:flex-grow-0 bg-white rounded-lg shadow hover:shadow-lg transition-all duration-300">
          <a href="{{ adv.get_absolute_url }}" class="block group">
            <div class="aspect-square mb-3 overflow-hidden rounded-lg">
              {% if adv.image %}
              <img src="{{ adv.image.url }}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" alt="{{ adv.title }}">
              {% else %}
              <img src="{% static 'img/adv.png' %}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" alt="{{ adv.title }}">
              {% endif %}
            </div>
            <h3 class="font-semibold text-gray-900 group-hover:text-blue-600 transition-colors duration-300 mb-2">{{ adv.title }}</h3>
            <p class="text-sm text-gray-600 mb-2">{{ adv.descriptions|truncatewords:10 }}</p>
            <div class="flex justify-between items-center">
              <span class="text-lg font-bold text-blue-600">{{ adv.prices }}</span>
              <span class="text-xs text-gray-500">{{ adv.created|date:"d.m" }}</span>
            </div>
          </a>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <div class="nav-tabs mb-8">
      <div class="flex space-x-2 p-2 overflow-x-auto flex-nowrap scrollbar-hide">
        <a href="#" class="nav-link active flex-shrink-0 px-6 py-3 text-sm font-medium text-white bg-blue-600 rounded-lg shadow-sm">
          Проверенные продавцы
        </a>
        {% if user.is_authenticated %}
        <a href="/favorites" class="flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300">
          Избранное
        </a>
        {% endif %}
      </div>
    </div>

    <!-- Основные объявления -->
    <div class="space-y-6">
      {% for adv in advertisements %}
      <div class="card bg-white/95 backdrop-blur-sm rounded-2xl shadow-sm border border-white/20 overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-1 fade-in" style="animation-delay: 0.2;">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-0">
          <div class="md:col-span-1">
            <a href="{{ adv.get_absolute_url }}" class="block group">
              <div class="aspect-square md:aspect-auto md:h-full overflow-hidden">
                {% if adv.image %}
                <img src="{{ adv.image.url }}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" alt="{{ adv.title }}">
                {% else %}
                <img src="{% static 'img/adv.png' %}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" alt="{{ adv.title }}">
                {% endif %}
              </div>
            </a>
          </div>
          <div class="md:col-span-2">
            <div class="card-body p-6">
              <a href="{{ adv.get_absolute_url }}" class="block group">
                <h2 class="card-title text-xl font-bold text-gray-900 mb-3 group-hover:text-blue-600 transition-colors duration-300">
                  {{ adv.title }}
                </h2>
                <p class="card-text text-gray-600 mb-4 line-clamp-3">
                  {{ adv.descriptions }}
                </p>
                <div class="flex flex-wrap gap-4 mb-4 text-sm">
                  <span class="flex items-center text-gray-500">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                    </svg>
                    Автор: {{ adv.user }}
                  </span>
                  <span class="flex items-center text-gray-500">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                    </svg>
                    {{ adv.created|date:"d.m.Y" }}
                  </span>
                </div>
                <div class="text-2xl font-bold text-blue-600 mb-4">{{ adv.prices }}</div>
              </a>
              
              {% if user.is_authenticated %}
              <div class="flex gap-2">
                {% if user in adv.favorites.all %}
                  <button type="submit" class="fav_toggle bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg font-medium hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300"
                    data-adv-id="{{ adv.id }}"
                    data-action="removed"
                  >
                    Удалить из избранного
                  </button>
                {% else %}
                  <button type="submit" class="fav_toggle bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300"
                    data-adv-id="{{ adv.id }}"
                    data-action="added"
                  >
                    Добавить в избранное
                  </button>
                {% endif %}
              </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<footer class="footer bg-gradient-to-r from-blue-600 to-blue-700 text-white mt-20">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="flex flex-col md:flex-row justify-between items-center">
      <div class="mb-4 md:mb-0">
        <p class="text-lg font-medium">This site made by Dan Alekseev</p>
      </div>
      <div class="flex space-x-4">
        <a href="https://github.com/Teslanot" class="group">
          <img src="{% static 'img/github_img.png' %}" alt="GitHub" class="w-12 h-12 rounded-lg group-hover:shadow-lg transform group-hover:-translate-y-1 transition-all duration-300">
        </a>
      </div>
    </div>
  </div>
</footer>

<script src="{% static 'js/carousel.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  document.body.classList.add('page-enter');
  setTimeout(() => {
    document.body.classList.add('page-enter-active');
  }, 100);
  
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.style.opacity = '1';
        entry.target.style.transform = 'translateY(0)';
      }
    });
  }, observerOptions);
  
  document.querySelectorAll('.fade-in').forEach(el => {
    observer.observe(el);
  });
});

document.addEventListener('click', function(e) {
  if (e.target.classList.contains('fav_toggle')) {
    const button = e.target;
    const advId = button.dataset.advId;
    const action = button.dataset.action;
    const url = action === 'add'
      ? `/add_to_favorites/${advId}/`
      : `/remove_from_favorite/${advId}/`;

    fetch(url, {
      method: 'POST',
      headers: {
        'X-CSRFToken': '{{ csrf_token }}',
        'Accept': 'application/json'
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        if (action === 'add') {
          button.textContent = 'Удалить из избранного';
          button.dataset.action = 'remove';
          button.classList.remove('from-blue-500', 'to-blue-600');
          button.classList.add('from-red-500', 'to-red-600');
        } else {
          button.textContent = 'Добавить в избранное';
          button.dataset.action = 'add';
          button.classList.remove('from-red-500', 'to-red-600');
          button.classList.add('from-blue-500', 'to-blue-600');
        }
      }
    })
    .catch(error => console.error(error));
  }
});  
</script>
{% endblock %}