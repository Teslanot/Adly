{% extends 'base.html' %}
{% load static %}
{% block title %}–û–±—ä—è–≤–ª–µ–Ω–∏–µ{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 to-white">
  <nav class="sticky top-0 z-50 backdrop-blur-xl bg-white/95 border-b border-white/20 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-center overflow-x-auto">
        <div class="flex space-x-1 p-2 flex-nowrap scrollbar-hide">
          <a href="{% url 'home' %}"
            class="flex-shrink-0 nav-link active px-6 py-3 text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-blue-500 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300">
            –ì–ª–∞–≤–Ω–∞—è
          </a>
          <a href="{% url 'top_sellers' %}"
            class="flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300 hover:-translate-y-0.5">
            –¢–æ–ø –ø—Ä–æ–¥–∞–≤—Ü–æ–≤
          </a>

          {% if not user.is_authenticated %}
          <a href="{% url 'sign_in' %}"
            class="flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300 hover:-translate-y-0.5">
            –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
          </a>
          <a href="{% url 'login' %}"
            class="flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300 hover:-translate-y-0.5">
            –í–æ–π—Ç–∏
          </a>
          {% else %}
          <a href="{% url 'post_adv' %}"
            class="flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300 hover:-translate-y-0.5">
            –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
          </a>
          <a href="{% url 'profile' %}"
            class="flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300 hover:-translate-y-0.5">
            –ü—Ä–æ—Ñ–∏–ª—å
          </a>
          <a href="{% url 'logout' %}"
            class="flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300 hover:-translate-y-0.5">
            –í—ã–π—Ç–∏
          </a>
          {% endif %}
        </div>
      </div>
    </div>
  </nav>

  <div class="max-w-4xl mx-auto mt-8 px-4">
    <div class="mb-4">
      <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-700">
        <img src="{{ adv.user.profile.avatar.url }}" class="w-6 h-6 rounded-full object-cover mr-2" alt="–ê–≤–∞—Ç–∞—Ä">
        üë§ {{ adv.user.username }}
      </span>
    </div>

    <div class="bg-white rounded-xl shadow-md overflow-hidden flex flex-col md:flex-row transition hover:shadow-lg">
      <div class="md:w-1/3 flex-shrink-0">
        {% if adv.image %}
          <img src="{{ adv.image.url }}" alt="{{ adv.title }}" class="w-full h-full object-cover">
        {% else %}
          <img src="{% static 'img/adv.png' %}" alt="{{ adv.title }}" class="w-full h-full object-cover">
        {% endif %}
      </div>
      <div class="md:w-2/3 p-6 flex flex-col justify-between">
        <div>
          <h2 class="text-2xl font-bold mb-2 text-gray-800">{{ adv.title }}</h2>
          <p class="text-gray-600 mb-4">{{ adv.descriptions }}</p>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-lg font-bold text-blue-600">
              {% if adv.prices == 0 %}
                  –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
              {% else %}
                  {{ adv.prices }} ‚ÇΩ
              {% endif %}
          </span>
          <small class="text-gray-500">{{ adv.created }}</small>
        </div>
      </div>
    </div>
  </div>
  <div class="max-w-4xl mx-auto p-4">

    <h2 class="text-xl font-bold mt-6 mb-4">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h2>

    {% if user.is_authenticated %}
      <form method="post" class="bg-gray-50 p-4 rounded-lg shadow-sm space-y-4">
        {% csrf_token %}
        <textarea name="text" rows="3" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."></textarea>
        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
      </form>
    {% else %}
      <p class="text-gray-600">–ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, <a href="{% url 'login' %}" class="text-blue-600 underline">–≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</a>.</p>
    {% endif %}

    {% for comment in comments %}
      <div class="bg-gray-100 p-4 rounded-lg shadow-sm flex gap-3 items-start mb-4">
        <img src="{{ comment.author.profile.avatar.url }}" class="w-10 h-10 rounded-full object-cover" alt="–ê–≤–∞—Ç–∞—Ä">
        <div>
          <div class="text-sm text-gray-800 font-semibold">
            {{ comment.author.username }}
            <span class="text-xs text-gray-500 ml-2">{{ comment.created_at|date:"d.m.Y H:i" }}</span>
          </div>
          <div class="text-gray-700 mt-1">{{ comment.text }}</div>

          {% if user.is_authenticated %}
            <button class="text-blue-600 text-sm mt-1 reply-toggle" data-id="{{ comment.id }}">–û—Ç–≤–µ—Ç–∏—Ç—å</button>

            <form method="post" class="reply-form mt-2 hidden" data-parent="{{ comment.id }}">
              {% csrf_token %}
              <textarea name="text" rows="2" class="w-full border rounded p-2 text-sm" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..."></textarea>
              <input type="hidden" name="parent" value="{{ comment.id }}">
              <button type="submit" class="mt-1 text-sm bg-blue-500 text-white px-3 py-1 rounded">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
            </form>
          {% endif %}

          {% for reply in comment.replies.all %}
            <div class="mt-4 ml-8 bg-gray-50 p-3 rounded shadow-sm flex gap-3 items-start">
              <img src="{{ reply.author.profile.avatar.url }}" class="w-8 h-8 rounded-full object-cover" alt="–ê–≤–∞—Ç–∞—Ä">
              <div>
                <div class="text-sm text-gray-800 font-semibold">
                  {{ reply.author.username }}
                  <span class="text-xs text-gray-500 ml-2">{{ reply.created_at|date:"d.m.Y H:i" }}</span>
                </div>
                <div class="text-gray-700 mt-1 text-sm">{{ reply.text }}</div>
              </div>
            </div>
          {% endfor %}

        </div>
      </div>
    {% empty %}
      <p class="text-gray-500">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</p>
    {% endfor %}
  </div>
</div>
<script>
  document.querySelectorAll('.reply-toggle').forEach(btn => {
    btn.addEventListener('click', () => {
      const form = btn.nextElementSibling;
      form.classList.toggle('hidden');
    });
  });
</script>
{% endblock %}